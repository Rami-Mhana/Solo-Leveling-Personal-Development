{% extends "base.html" %}
{% block title %}Manage Stats{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <h2 class="text-2xl font-semibold text-white mb-4">Manage Your Stats</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-gray-800 p-4 rounded">
      <h3 class="text-lg font-medium text-white">Core (System-defined)</h3>
      <div class="mt-3 space-y-2 text-gray-300">
        {% for k, v in core.items() %}
          <div class="flex justify-between"><span class="capitalize">{{ k.replace('_',' ') }}</span><span>{{ v }}</span></div>
        {% endfor %}
      </div>
    </div>

    <div class="bg-gray-800 p-4 rounded">
      <h3 class="text-lg font-medium text-white">Player-defined (Editable)</h3>
      <form id="playerStatsForm" class="mt-3 space-y-3">
        {% for k, v in player.items() %}
          <div>
            <label class="block text-sm text-gray-300 capitalize">{{ k.replace('_',' ') }}</label>
            <input name="{{ k }}" value="{{ v }}" class="mt-1 block w-full px-3 py-2 rounded bg-gray-900 border border-gray-700 text-white">
          </div>
        {% endfor %}
        <div class="pt-2">
          <button type="button" id="saveStats" class="px-4 py-2 bg-purple-600 rounded text-white">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% block scripts %}
<script>
document.getElementById('saveStats')?.addEventListener('click', async function(){
  const form = document.getElementById('playerStatsForm');
  const fd = new FormData(form);
  const data = Object.fromEntries(fd.entries());

  // Convert numeric-looking values
  Object.keys(data).forEach(k => {
    const n = Number(data[k]);
    if (!isNaN(n)) data[k] = n;
  });

  const res = await fetch('{{ url_for("pd.update_stats") }}', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  const json = await res.json();
  if (json.success) {
    alert('Stats updated');
    location.reload();
  } else {
    alert(json.message || 'Failed to update stats');
  }
});
</script>
{% endblock %}

{% endblock %}